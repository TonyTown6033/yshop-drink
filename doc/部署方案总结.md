# 🚀 YSHOP 部署方案总结

## 📊 三种部署方式对比

| 方案 | 编译位置 | 启动时间 | 服务器负载 | 适用场景 | 复杂度 |
|------|----------|----------|------------|----------|--------|
| 1. 服务器编译 | 服务器 | 10分钟 | 高 | 开发环境 | ⭐ |
| 2. 本地预编译 | 本地/开发机 | 1分钟 | 低 | 小团队 | ⭐⭐ |
| 3. GitHub Actions | GitHub 云端 | 1分钟 | 极低 | **生产环境** | ⭐⭐⭐ |

---

## 🎯 方案1：服务器直接编译

### 使用场景
- 开发环境
- 首次部署
- 测试环境

### 命令
```bash
sudo ./start-server.sh
```

### 流程
```
代码 → 服务器 → 编译 → 启动
        ↓
    10分钟编译
    高CPU/内存占用
```

### 优点
- ✅ 简单直接
- ✅ 不需要额外工具

### 缺点
- ❌ 编译时间长
- ❌ 占用服务器资源
- ❌ 影响线上性能

---

## 🔧 方案2：本地预编译

### 使用场景
- 小团队
- 无 CI/CD 环境
- 需要快速部署

### 命令
```bash
# 本地
./build-local.sh
scp yshop-deploy-*.tar.gz server:/tmp/

# 服务器
sudo ./start-server.sh --skip-build --prod-frontend
```

### 流程
```
代码 → 本地编译 → 打包 → 上传 → 服务器部署
        ↓          ↓      ↓       ↓
    5-8分钟      1分钟   2分钟   30秒
```

### 优点
- ✅ 服务器零编译负载
- ✅ 部署速度快
- ✅ 不依赖第三方服务

### 缺点
- ❌ 需要本地编译环境
- ❌ 手动上传文件
- ❌ 版本管理不便

---

## 🌟 方案3：GitHub Actions 自动编译（推荐）

### 使用场景
- 生产环境
- 多人协作
- 需要版本管理
- 自动化部署

### 命令
```bash
# 发布端
git tag v2.9.0
git push origin v2.9.0

# 服务器（几分钟后）
sudo ./start-server.sh --github-release
```

### 流程
```
代码 → 推送Tag → GitHub自动编译 → 创建Release → 服务器下载部署
        ↓          ↓                  ↓              ↓
    几秒       5-8分钟(云端)        自动           30秒
```

### 优点
- ✅ 完全自动化
- ✅ 服务器零负载
- ✅ 版本可追溯
- ✅ 支持回滚
- ✅ 部署速度快
- ✅ 多服务器复用

### 缺点
- ❌ 需要 GitHub 账号
- ❌ 首次配置略复杂
- ❌ 依赖网络（国内可能慢）

---

## 📋 完整对比表

### 性能对比

| 指标 | 方案1 | 方案2 | 方案3 |
|------|-------|-------|-------|
| 首次部署时间 | 10分钟 | 8分钟 | 10分钟* |
| 后续部署时间 | 10分钟 | 3分钟 | 1分钟 |
| 服务器CPU占用 | 80-100% | 5-10% | 5-10% |
| 服务器内存占用 | 2-4GB | 200MB | 200MB |
| 网络带宽 | 低 | 中 | 中 |

\* GitHub Actions 编译时间不影响服务器

### 成本对比

| 成本项 | 方案1 | 方案2 | 方案3 |
|--------|-------|-------|-------|
| 服务器配置要求 | 高 | 低 | 低 |
| 本地开发机要求 | 低 | 高 | 低 |
| CI/CD 成本 | 无 | 无 | 免费** |
| 人力成本 | 低 | 中 | 低*** |

\** GitHub Actions 公开仓库免费  
\*** 初始配置后完全自动化

### 可靠性对比

| 指标 | 方案1 | 方案2 | 方案3 |
|------|-------|-------|-------|
| 版本管理 | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 回滚便利性 | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 一致性保证 | ⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 故障恢复 | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 审计追踪 | ⭐ | ⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## 🎓 实际案例

### 案例1：小型项目（个人开发）

**场景**：1个开发者，1台服务器

**推荐**：方案1（服务器编译）

**理由**：
- 简单直接
- 不需要额外配置
- 服务器资源充足

```bash
# 开发流程
git push
ssh server "cd project && git pull && sudo ./start-server.sh"
```

---

### 案例2：中型项目（小团队）

**场景**：3-5个开发者，2-3台服务器

**推荐**：方案2（本地预编译）或 方案3（GitHub Actions）

**理由**：
- 避免服务器编译负载
- 需要版本管理
- 多服务器部署

```bash
# 使用方案2
./build-local.sh
for server in server1 server2; do
    scp deploy/*.tar.gz $server:/tmp/
    ssh $server "deploy-script"
done

# 或使用方案3
git tag v2.9.0 && git push origin v2.9.0
# 然后在各服务器
sudo ./start-server.sh --github-release
```

---

### 案例3：大型项目（企业级）

**场景**：10+开发者，多环境（开发/测试/生产），多台服务器

**推荐**：方案3（GitHub Actions）+ CI/CD

**理由**：
- 完全自动化
- 版本管理严格
- 支持多环境
- 便于回滚

```bash
# 开发环境：自动部署 main 分支
git push origin main
# 触发开发环境自动部署

# 生产环境：发布版本
git tag v2.9.0
git push origin v2.9.0
# GitHub Actions 自动构建
# 生产服务器自动或手动部署
```

---

## 🔄 迁移路径

### 从方案1升级到方案2

```bash
# 1. 准备本地编译环境
# 安装 JDK 17, Maven, Node.js, pnpm

# 2. 使用编译脚本
./build-local.sh

# 3. 上传并部署
scp yshop-deploy-*.tar.gz server:/tmp/
ssh server "sudo ./start-server.sh --skip-build --prod-frontend"
```

### 从方案1/2升级到方案3

```bash
# 1. 推送代码到 GitHub
git remote add origin https://github.com/username/yshop-drink.git
git push -u origin master

# 2. 检查 GitHub Actions 配置
# 文件已存在：.github/workflows/build-release.yml

# 3. 创建第一个发布
git tag v2.9.0 -m "First release"
git push origin v2.9.0

# 4. 等待 GitHub Actions 完成（约5-8分钟）

# 5. 服务器部署
sudo ./start-server.sh --github-release v2.9.0
```

---

## 🎯 推荐选择

### 个人项目
```
建议：方案1（服务器编译）
原因：简单够用，资源充足
```

### 小团队项目
```
建议：方案2（本地预编译）
原因：平衡简单和效率
```

### 生产环境
```
建议：方案3（GitHub Actions）
原因：专业、自动化、可靠
```

### 企业级项目
```
必选：方案3（GitHub Actions）+ 完整 CI/CD
原因：必须的标准流程
```

---

## 📊 决策树

```
开始
  │
  ├─ 是否需要频繁部署？
  │   ├─ 否 → 方案1（服务器编译）
  │   └─ 是 ↓
  │
  ├─ 是否有多台服务器？
  │   ├─ 否 → 方案1 或 方案2
  │   └─ 是 ↓
  │
  ├─ 是否需要版本管理？
  │   ├─ 否 → 方案2（本地预编译）
  │   └─ 是 ↓
  │
  ├─ 是否有 GitHub 账号？
  │   ├─ 否 → 方案2（本地预编译）
  │   └─ 是 ↓
  │
  └─ 推荐：方案3（GitHub Actions）✅
```

---

## 🛠️ 工具脚本总览

### 核心脚本

| 脚本 | 功能 | 使用场景 |
|------|------|----------|
| `start-server.sh` | 启动服务（支持多种模式） | 所有场景 |
| `stop-server.sh` | 停止服务 | 所有场景 |
| `clean-ports.sh` | 清理端口占用 | 故障排查 |
| `build-local.sh` | 本地编译 | 方案2 |

### GitHub Actions

| 文件 | 功能 | 使用场景 |
|------|------|----------|
| `.github/workflows/build-release.yml` | 自动构建和发布 | 方案3 |

### 文档

| 文档 | 说明 |
|------|------|
| `RELEASE-GUIDE.md` | 快速参考 |
| `doc/GitHub-Actions部署指南.md` | 方案3详细说明 |
| `doc/预编译部署指南.md` | 方案2详细说明 |
| `doc/端口清理指南.md` | 故障排查 |
| `doc/nvm使用说明.md` | Node.js管理 |

---

## 📞 快速帮助

### 方案1：服务器编译
```bash
sudo ./start-server.sh
```
📖 查看：项目 README

### 方案2：本地预编译
```bash
./build-local.sh
scp yshop-deploy-*.tar.gz server:/tmp/
sudo ./start-server.sh --skip-build --prod-frontend
```
📖 查看：[预编译部署指南](预编译部署指南.md)

### 方案3：GitHub Actions
```bash
git tag v2.9.0 && git push origin v2.9.0
sudo ./start-server.sh --github-release
```
📖 查看：[GitHub Actions 部署指南](GitHub-Actions部署指南.md)

---

## 🎉 总结

- 🚀 **开发/测试**：使用方案1，简单快速
- 🔧 **小团队**：使用方案2，平衡效率
- ⭐ **生产环境**：使用方案3，专业可靠

**现在你有了完整的部署方案！选择适合你的方式开始吧！** 🎊

---

**更新时间**：2025-11-25  
**版本**：v1.0

