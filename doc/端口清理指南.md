# ç«¯å£æ¸…ç†æŒ‡å—

## ğŸ¯ é—®é¢˜æè¿°

å¯åŠ¨ Docker å®¹å™¨æ—¶é‡åˆ°ç«¯å£å ç”¨é”™è¯¯ï¼š

```
Error response from daemon: failed to set up container networking: 
driver failed programming external connectivity on endpoint yshop-mysql: 
Bind for 127.0.0.1:3306 failed: port is already allocated
```

è¿™æ˜¯å› ä¸ºç«¯å£ï¼ˆ3306ã€6379 ç­‰ï¼‰å·²è¢«å…¶ä»–è¿›ç¨‹å ç”¨ã€‚

---

## ğŸš€ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨æ¸…ç†è„šæœ¬ï¼ˆæ¨èï¼‰âœ¨

```bash
# è¿è¡Œç«¯å£æ¸…ç†è„šæœ¬
sudo ./clean-ports.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- âœ… è‡ªåŠ¨æ£€æŸ¥æ‰€æœ‰éœ€è¦çš„ç«¯å£ï¼ˆ3306ã€6379ã€48081ã€80ï¼‰
- âœ… æ˜¾ç¤ºå ç”¨è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯
- âœ… æ™ºèƒ½åœæ­¢ YSHOP Docker å®¹å™¨
- âœ… æ¸…ç†å‰©ä½™çš„ç«¯å£å ç”¨
- âœ… å®‰å…¨å‹å¥½çš„äº¤äº’å¼æç¤º

### æ–¹æ¡ˆ2ï¼šå¯åŠ¨è„šæœ¬è‡ªåŠ¨æ¸…ç†

```bash
# ç›´æ¥è¿è¡Œå¯åŠ¨è„šæœ¬
sudo ./start-server.sh
```

å¯åŠ¨è„šæœ¬ç°åœ¨ä¼šï¼š
- âœ… åœ¨å¯åŠ¨ Docker å‰è‡ªåŠ¨æ£€æŸ¥ç«¯å£
- âœ… å¦‚æœç«¯å£è¢«å ç”¨ï¼Œæç¤ºå¹¶æ¸…ç†
- âœ… æ¸…ç†å®Œæˆåç»§ç»­å¯åŠ¨æœåŠ¡

### æ–¹æ¡ˆ3ï¼šæ‰‹åŠ¨æ¸…ç†

```bash
# 1. æŸ¥çœ‹ç«¯å£å ç”¨
sudo lsof -i :3306
sudo lsof -i :6379

# 2. åœæ­¢ YSHOP å®¹å™¨
docker stop $(docker ps -q --filter "name=yshop-")

# 3. å¼ºåˆ¶åœæ­¢è¿›ç¨‹ï¼ˆå¦‚æœéœ€è¦ï¼‰
sudo kill -9 <PID>
```

---

## ğŸ“‹ ç«¯å£æ¸…ç†è„šæœ¬è¯¦è§£

### æ£€æŸ¥çš„ç«¯å£

| ç«¯å£  | æœåŠ¡       | è¯´æ˜                     |
|-------|------------|--------------------------|
| 3306  | MySQL      | æ•°æ®åº“æœåŠ¡               |
| 6379  | Redis      | ç¼“å­˜æœåŠ¡                 |
| 48081 | åç«¯æœåŠ¡   | Spring Boot åº”ç”¨         |
| 80    | å‰ç«¯æœåŠ¡   | Vue3 ç®¡ç†ç•Œé¢            |

### ä½¿ç”¨ç¤ºä¾‹

```bash
# 1. è¿è¡Œè„šæœ¬
sudo ./clean-ports.sh

# 2. æŸ¥çœ‹ç«¯å£çŠ¶æ€
âœ“ ç«¯å£ 6379 (Redis) å¯ç”¨
âœ— ç«¯å£ 3306 (MySQL) å·²è¢«å ç”¨
  PID: 12345
  è¿›ç¨‹: mysqld
  ç”¨æˆ·: mysql

# 3. é€‰æ‹©æ“ä½œ
æ˜¯å¦åœæ­¢è¿™äº›å®¹å™¨? (y/n) y
æ˜¯å¦æ¸…ç†å‰©ä½™ç«¯å£? (y/n) y

# 4. å®Œæˆ
âœ… æ‰€æœ‰ç«¯å£å·²æ¸…ç†ï¼Œç°åœ¨å¯ä»¥å¯åŠ¨æœåŠ¡
```

---

## ğŸ” å¸¸è§åœºæ™¯

### åœºæ™¯1ï¼šDocker å®¹å™¨å ç”¨ç«¯å£

**ç°è±¡**ï¼š
```bash
docker ps
# æ˜¾ç¤º yshop-mysql å’Œ yshop-redis æ­£åœ¨è¿è¡Œ
```

**è§£å†³**ï¼š
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨æ¸…ç†è„šæœ¬
sudo ./clean-ports.sh
# è„šæœ¬ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶åœæ­¢å®¹å™¨

# æ–¹æ³•2ï¼šæ‰‹åŠ¨åœæ­¢
docker stop yshop-mysql yshop-redis
```

### åœºæ™¯2ï¼šç³»ç»Ÿ MySQL æœåŠ¡å ç”¨ç«¯å£

**ç°è±¡**ï¼š
```bash
sudo lsof -i :3306
# mysqld  12345  mysql   23u  IPv4  0x...  TCP localhost:3306
```

**è§£å†³**ï¼š
```bash
# æ–¹æ³•1ï¼šåœæ­¢ç³»ç»Ÿ MySQL
sudo systemctl stop mysql

# æ–¹æ³•2ï¼šä½¿ç”¨æ¸…ç†è„šæœ¬
sudo ./clean-ports.sh
# é€‰æ‹© 'y' æ¸…ç†ç«¯å£
```

### åœºæ™¯3ï¼šåç«¯æœåŠ¡å ç”¨ç«¯å£

**ç°è±¡**ï¼š
```bash
sudo lsof -i :48081
# java  12345  user   23u  IPv4  0x...  TCP *:48081
```

**è§£å†³**ï¼š
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨åœæ­¢è„šæœ¬
sudo ./stop-server.sh

# æ–¹æ³•2ï¼šä½¿ç”¨æ¸…ç†è„šæœ¬
sudo ./clean-ports.sh

# æ–¹æ³•3ï¼šæ‰‹åŠ¨åœæ­¢
pkill -f yshop-server
```

### åœºæ™¯4ï¼šå‰ç«¯æœåŠ¡å ç”¨ç«¯å£

**ç°è±¡**ï¼š
```bash
sudo lsof -i :80
# node  12345  user   23u  IPv4  0x...  TCP *:80
```

**è§£å†³**ï¼š
```bash
# ä½¿ç”¨æ¸…ç†è„šæœ¬æˆ–åœæ­¢è„šæœ¬
sudo ./clean-ports.sh
# æˆ–
sudo ./stop-server.sh
```

---

## ğŸ› ï¸ æ‰‹åŠ¨æ¸…ç†å‘½ä»¤

### æŸ¥çœ‹ç«¯å£å ç”¨

```bash
# æŸ¥çœ‹å•ä¸ªç«¯å£
sudo lsof -i :3306

# æŸ¥çœ‹å¤šä¸ªç«¯å£
sudo lsof -i :3306 -i :6379 -i :48081 -i :80

# åªæ˜¾ç¤º PID
sudo lsof -ti :3306

# æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
sudo netstat -tulpn | grep :3306
```

### åœæ­¢è¿›ç¨‹

```bash
# ä¼˜é›…åœæ­¢ï¼ˆæ¨èï¼‰
sudo kill <PID>

# å¼ºåˆ¶åœæ­¢
sudo kill -9 <PID>

# é€šè¿‡ç«¯å£åœæ­¢
sudo kill $(sudo lsof -ti :3306)

# å¼ºåˆ¶åœæ­¢é€šè¿‡ç«¯å£
sudo kill -9 $(sudo lsof -ti :3306)
```

### åœæ­¢ Docker å®¹å™¨

```bash
# åœæ­¢æ‰€æœ‰ YSHOP å®¹å™¨
docker stop $(docker ps -q --filter "name=yshop-")

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker stop $(docker ps -q --filter "name=yshop-")
docker rm $(docker ps -aq --filter "name=yshop-")

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps --filter "name=yshop-"
```

---

## ğŸ”§ é¢„é˜²æªæ–½

### 1. ä½¿ç”¨åœæ­¢è„šæœ¬

åœ¨é‡å¯æœåŠ¡å‰ï¼Œå…ˆåœæ­¢ç°æœ‰æœåŠ¡ï¼š

```bash
# 1. åœæ­¢æœåŠ¡
sudo ./stop-server.sh

# 2. æ¸…ç†ç«¯å£ï¼ˆå¦‚æœéœ€è¦ï¼‰
sudo ./clean-ports.sh

# 3. å¯åŠ¨æœåŠ¡
sudo ./start-server.sh
```

### 2. ä¿®æ”¹ç«¯å£é…ç½®

å¦‚æœæŸäº›ç«¯å£æ°¸ä¹…è¢«å ç”¨ï¼Œå¯ä»¥ä¿®æ”¹é…ç½®ï¼š

**ä¿®æ”¹ MySQL ç«¯å£**ï¼š
```yaml
# docker-compose.yml
services:
  mysql:
    ports:
      - "3307:3306"  # æ”¹ç”¨ 3307
```

**ä¿®æ”¹åç«¯ç«¯å£**ï¼š
```yaml
# application-local.yaml
server:
  port: 48082  # æ”¹ç”¨ 48082
```

**ä¿®æ”¹å‰ç«¯ç«¯å£**ï¼š
```javascript
// vite.config.js
export default {
  server: {
    port: 8080  // æ”¹ç”¨ 8080
  }
}
```

### 3. ä½¿ç”¨ Docker Compose

```bash
# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨
docker compose down

# å¯åŠ¨æœåŠ¡
docker compose up -d
```

---

## ğŸ“Š è„šæœ¬å¯¹æ¯”

### clean-ports.sh

**ç‰¹ç‚¹**ï¼š
- âœ… ä¸“é—¨ç”¨äºæ¸…ç†ç«¯å£
- âœ… äº¤äº’å¼æ“ä½œï¼Œå®‰å…¨å¯æ§
- âœ… æ˜¾ç¤ºè¯¦ç»†çš„ç«¯å£å ç”¨ä¿¡æ¯
- âœ… æ™ºèƒ½è¯†åˆ« Docker å®¹å™¨
- âœ… å¯å•ç‹¬è¿è¡Œ

**ä½¿ç”¨åœºæ™¯**ï¼š
- å¯åŠ¨æœåŠ¡å‰æ£€æŸ¥ç«¯å£
- ç«¯å£å ç”¨æ•…éšœæ’æŸ¥
- æ‰‹åŠ¨æ¸…ç†æµ‹è¯•ç¯å¢ƒ

### start-server.shï¼ˆé›†æˆæ¸…ç†ï¼‰

**ç‰¹ç‚¹**ï¼š
- âœ… å¯åŠ¨å‰è‡ªåŠ¨æ£€æŸ¥
- âœ… é›†æˆåˆ°å¯åŠ¨æµç¨‹
- âœ… ä¸€é”®å¼æ“ä½œ

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ—¥å¸¸å¯åŠ¨æœåŠ¡
- è‡ªåŠ¨åŒ–éƒ¨ç½²
- å¿«é€Ÿé‡å¯

### stop-server.sh

**ç‰¹ç‚¹**ï¼š
- âœ… ä¼˜é›…åœæ­¢æœåŠ¡
- âœ… ä¸å¼ºåˆ¶æ€æ­»è¿›ç¨‹
- âœ… ä¿ç•™æ•°æ®

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ­£å¸¸åœæ­¢æœåŠ¡
- æœåŠ¡ç»´æŠ¤
- é‡å¯å‰å‡†å¤‡

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ ‡å‡†æµç¨‹

```bash
# åœæ­¢ â†’ æ¸…ç† â†’ å¯åŠ¨
sudo ./stop-server.sh
sudo ./clean-ports.sh
sudo ./start-server.sh
```

### 2. å¿«é€Ÿé‡å¯

```bash
# åœæ­¢åç›´æ¥å¯åŠ¨ï¼ˆå¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨æ¸…ç†ï¼‰
sudo ./stop-server.sh
sudo ./start-server.sh
```

### 3. æ•…éšœæ’æŸ¥

```bash
# 1. æ£€æŸ¥ç«¯å£
sudo ./clean-ports.sh

# 2. æŸ¥çœ‹æ—¥å¿—
tail -f ~/logs/yshop-server.log

# 3. æ£€æŸ¥å®¹å™¨
docker ps -a
docker logs yshop-mysql
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®å®‰å…¨

- âš ï¸ å¼ºåˆ¶åœæ­¢ MySQL å¯èƒ½å¯¼è‡´æ•°æ®æŸå
- âœ… ä¼˜å…ˆä½¿ç”¨ä¼˜é›…åœæ­¢
- âœ… é‡è¦æ•°æ®è¯·æå‰å¤‡ä»½

### 2. æƒé™é—®é¢˜

- âš ï¸ æ¸…ç†ç«¯å£éœ€è¦ sudo æƒé™
- âœ… ç¡®ä¿ä½¿ç”¨ `sudo ./clean-ports.sh`

### 3. ç³»ç»ŸæœåŠ¡

- âš ï¸ ä¸è¦åœæ­¢ç³»ç»Ÿå…³é”®æœåŠ¡
- âœ… ä»”ç»†ç¡®è®¤è¦åœæ­¢çš„è¿›ç¨‹
- âœ… è„šæœ¬ä¼šæç¤ºç¡®è®¤

---

## ğŸ†˜ ç´§æ€¥æƒ…å†µ

### æƒ…å†µ1ï¼šæ¸…ç†è„šæœ¬æ— æ³•æ¸…ç†

```bash
# 1. æ‰‹åŠ¨æŸ¥æ‰¾è¿›ç¨‹
sudo lsof -i :3306

# 2. å¼ºåˆ¶åœæ­¢
sudo kill -9 <PID>

# 3. é‡å¯ Docker
sudo systemctl restart docker
```

### æƒ…å†µ2ï¼šç«¯å£è¢«ç³»ç»ŸæœåŠ¡å ç”¨

```bash
# æŸ¥çœ‹æœåŠ¡
sudo systemctl list-units | grep mysql

# åœæ­¢æœåŠ¡
sudo systemctl stop mysql

# ç¦ç”¨è‡ªåŠ¨å¯åŠ¨ï¼ˆå¦‚æœä¸éœ€è¦ç³»ç»Ÿ MySQLï¼‰
sudo systemctl disable mysql
```

### æƒ…å†µ3ï¼šæ— æ³•ç¡®å®šå ç”¨è¿›ç¨‹

```bash
# æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œè¿æ¥
sudo netstat -tulpn

# æŸ¥çœ‹è¿›ç¨‹æ ‘
ps aux | grep mysql

# é‡å¯ç³»ç»Ÿï¼ˆæœ€åæ‰‹æ®µï¼‰
sudo reboot
```

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆå¯åŠ¨è„šæœ¬æ²¡æœ‰è‡ªåŠ¨æ¸…ç†ï¼Ÿ

A: å¯åŠ¨è„šæœ¬ä¼šæç¤ºç¡®è®¤ã€‚å¦‚æœä½ é€‰æ‹©äº† 'n'ï¼Œéœ€è¦æ‰‹åŠ¨è¿è¡Œæ¸…ç†è„šæœ¬ï¼š
```bash
sudo ./clean-ports.sh
```

### Q2: æ¸…ç†åç«¯å£è¿˜æ˜¯è¢«å ç”¨ï¼Ÿ

A: å¯èƒ½æ˜¯æ¸…ç†ä¸å®Œå…¨æˆ–æœ‰æ–°è¿›ç¨‹å¯åŠ¨ã€‚å°è¯•ï¼š
```bash
# 1. é‡æ–°è¿è¡Œæ¸…ç†è„šæœ¬
sudo ./clean-ports.sh

# 2. æ£€æŸ¥ Docker
docker ps -a

# 3. é‡å¯ Docker
sudo systemctl restart docker
```

### Q3: å¯ä»¥ä¿®æ”¹æ¸…ç†è„šæœ¬æ£€æŸ¥çš„ç«¯å£å—ï¼Ÿ

A: å¯ä»¥ã€‚ç¼–è¾‘ `clean-ports.sh`ï¼Œä¿®æ”¹ `PORTS` æ•°ç»„ï¼š
```bash
declare -A PORTS=(
    [3306]="MySQL"
    [6379]="Redis"
    [48081]="åç«¯æœåŠ¡"
    [80]="å‰ç«¯æœåŠ¡"
    [8080]="å…¶ä»–æœåŠ¡"  # æ·»åŠ æ–°ç«¯å£
)
```

---

## ğŸ‰ æ€»ç»“

### ä¸‰æ­¥è§£å†³ç«¯å£å ç”¨

```bash
1. sudo ./clean-ports.sh      # æ¸…ç†ç«¯å£
2. sudo ./start-server.sh     # å¯åŠ¨æœåŠ¡
3. å®Œæˆï¼
```

### è®°ä½è¿™ä¸‰ä¸ªè„šæœ¬

- `clean-ports.sh` - æ¸…ç†ç«¯å£å ç”¨
- `start-server.sh` - å¯åŠ¨æ‰€æœ‰æœåŠ¡
- `stop-server.sh` - åœæ­¢æ‰€æœ‰æœåŠ¡

ç°åœ¨ç«¯å£å ç”¨é—®é¢˜å·²ç»å®Œç¾è§£å†³ï¼ğŸŠ

---

**æ›´æ–°æ—¶é—´**: 2025-11-25  
**ç‰ˆæœ¬**: v1.0

